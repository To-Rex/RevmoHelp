import{d as y,r as o,s}from"./index-DO34fR0A.js";import{a as N,b,m as p}from"./notifications-BFjoIerH.js";const A=()=>{const{user:c,loading:u}=y(),[h,l]=o.useState([]),[m,f]=o.useState(0),[g,d]=o.useState(!0);o.useEffect(()=>{if(u||!c){d(!1);return}n(),r();const t=setInterval(()=>{r()},3e4);if(!s)return()=>clearInterval(t);const a=s.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},()=>{n(),r()}).subscribe();return()=>{clearInterval(t),s&&s.removeChannel(a)}},[c,u]);const n=async()=>{try{const{data:t}=await N();t&&l(t)}catch(t){console.error("Error loading notifications:",t)}finally{d(!1)}},r=async()=>{try{const{count:t}=await b();f(t)}catch(t){console.error("Error loading unread count:",t)}};return{notifications:h,unreadCount:m,loading:g,markAsRead:async t=>{try{const{error:a}=await p(t);a||(l(i=>i.map(e=>e.id===t?{...e,read_by:[...e.read_by,"current-user"]}:e)),f(i=>Math.max(0,i-1)))}catch(a){console.error("Error marking notification as read:",a)}},refreshNotifications:()=>{n(),r()}}};export{A as u};
