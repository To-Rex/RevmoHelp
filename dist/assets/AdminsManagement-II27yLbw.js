import{m as J,c as Q,a as V,r as n,K as W,j as e,X as R,S as Y,M as ee,N as te,O as re,P as se}from"./index-DO34fR0A.js";import{P as ae}from"./plus-BSLlz3XA.js";import{C as N}from"./check-circle-DItbFGDG.js";import{A as v}from"./alert-circle-CDWwFaqK.js";import{S as L}from"./search-Ck5ZdOCr.js";import{C as le}from"./clock-mDGFTiaF.js";import{S as de}from"./square-pen-NYggparf.js";import{T as ne}from"./trash-2-Dgq6CDrx.js";import{E as M}from"./eye-off-BifHD6Hh.js";import{E as $}from"./eye-BSzZDvbN.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=J("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),ye=()=>{const{t}=Q(),{admin:c}=V(),[h,P]=n.useState([]),[w,k]=n.useState(!0),[f,q]=n.useState(""),[T,C]=n.useState(!1),[F,S]=n.useState(!1),[u,z]=n.useState(null),[p,b]=n.useState(!1),[A,_]=n.useState(null),[l,a]=n.useState({type:"",text:""}),[m,y]=n.useState(!1),[s,j]=n.useState({login:"",password:"",full_name:"",phone:"",role:"moderator"});n.useEffect(()=>{g()},[]);const g=async()=>{k(!0);try{const{data:r}=await W();r&&P(r)}catch{a({type:"error",text:t("errorLoadingAdmins")})}finally{k(!1)}},o=r=>{const{name:i,value:d}=r.target;j(G=>({...G,[i]:d})),l.text&&a({type:"",text:""})},D=()=>{j({login:"",password:"",full_name:"",phone:"",role:"moderator"}),y(!1),z(null)},I=()=>{D(),C(!0)},O=r=>{j({login:r.login,password:"",full_name:r.full_name,phone:r.phone||"",role:r.role}),z(r),S(!0)},x=()=>{C(!1),S(!1),D(),a({type:"",text:""})},U=async r=>{if(r.preventDefault(),!s.login.trim()){a({type:"error",text:t("loginRequiredForm")});return}if(!s.password.trim()){a({type:"error",text:t("passwordRequired")});return}if(!s.full_name.trim()){a({type:"error",text:t("fullNameRequired")});return}b(!0),a({type:"",text:""});try{const{data:i,error:d}=await re(s.login,s.password,s.full_name,s.phone,s.role);d?a({type:"error",text:d.message}):(a({type:"success",text:t("adminCreated")}),await g(),setTimeout(()=>{x()},1500))}catch{a({type:"error",text:t("error")})}finally{b(!1)}},H=async r=>{if(r.preventDefault(),!!u){b(!0),a({type:"",text:""});try{const{data:i,error:d}=await se(u.id,{login:s.login,password:s.password||void 0,full_name:s.full_name,phone:s.phone,role:s.role});d?a({type:"error",text:d.message}):(a({type:"success",text:t("adminUpdated")}),await g(),setTimeout(()=>{x()},1500))}catch{a({type:"error",text:t("error")})}finally{b(!1)}}},K=async(r,i)=>{if(r===c?.id){a({type:"error",text:t("cannotDeleteSelf")});return}if(confirm(`${i} ${t("confirmDeleteAdmin")}`)){_(r),a({type:"",text:""});try{const{error:d}=await te(r);d?a({type:"error",text:d.message}):(a({type:"success",text:t("adminDeleted")}),await g())}catch{a({type:"error",text:t("error")})}finally{_(null)}}},E=h.filter(r=>r.full_name.toLowerCase().includes(f.toLowerCase())||r.login.toLowerCase().includes(f.toLowerCase())),X=r=>{switch(r){case"admin":return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";case"moderator":return"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},Z=r=>r==="admin"?oe:ee,B=r=>new Date(r).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return w?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:t("adminsLoading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:t("adminsManagement")}),e.jsx("p",{className:"theme-text-secondary",children:t("manageAdminsDesc")})]}),c?.role==="admin"&&e.jsxs("button",{onClick:I,className:"flex items-center space-x-2 theme-accent-bg text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(ae,{size:20}),e.jsx("span",{children:t("newAdmin")})]})]}),l.text&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center space-x-2 animate-slide-down ${l.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[l.type==="success"?e.jsx(N,{size:20,className:"text-green-600 dark:text-green-400"}):e.jsx(v,{size:20,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:l.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300",children:l.text})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold theme-text",children:h.length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:t("totalAdmins")})]}),e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:h.filter(r=>r.role==="admin").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:t("superAdmins")})]}),e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.filter(r=>r.role==="moderator").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:t("moderators")})]}),e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.filter(r=>r.active).length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:t("activeAdmins")})]})]}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:t("searchAdmins"),value:f,onChange:r=>q(r.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]})}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y theme-border",children:[e.jsx("thead",{className:"theme-bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("adminTable")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("login")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("role")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("phone")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("created")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium theme-text-muted uppercase tracking-wider",children:t("actions")})]})}),e.jsx("tbody",{className:"theme-bg divide-y theme-border",children:E.map((r,i)=>{const d=Z(r.role);return e.jsxs("tr",{className:`${i%2===0?"bg-white":"bg-gray-50"} hover:bg-gray-100 transition-colors duration-200 border-b border-gray-200`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${r.role==="admin"?"bg-red-100 dark:bg-red-900":"bg-orange-100 dark:bg-orange-900"}`,children:e.jsx(d,{size:18,className:r.role==="admin"?"text-red-600 dark:text-red-400":"text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium theme-text",children:r.full_name}),e.jsx("div",{className:"text-sm theme-text-muted",children:r.id===c?.id&&e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:t("you")})})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm theme-text font-mono",children:["@",r.login]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full capitalize ${X(r.role)}`,children:r.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm theme-text",children:r.phone||t("notEntered")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${r.active?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:r.active?t("active"):t("inactive")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm theme-text-muted",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(le,{size:14}),e.jsx("span",{children:B(r.created_at)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("div",{className:"flex items-center justify-end space-x-2",children:c?.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>O(r),className:"theme-accent hover:text-blue-900 dark:hover:text-blue-300 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors duration-200",children:e.jsx(de,{size:16})}),r.id!==c?.id&&e.jsx("button",{onClick:()=>K(r.id,r.full_name),disabled:A===r.id,className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900 transition-colors duration-200 disabled:opacity-50",children:A===r.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(ne,{size:16})})]})})})]},r.id)})})]})})}),E.length===0&&!w&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(L,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold theme-text-secondary mb-2",children:t("adminNotFound")}),e.jsx("p",{className:"theme-text-muted",children:t("changeSearchTerm")})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"theme-bg rounded-2xl theme-shadow-lg theme-border border p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold theme-text",children:t("addNewAdmin")}),e.jsx("button",{onClick:x,className:"theme-text-secondary hover:theme-text",children:e.jsx(R,{size:20})})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[l.text&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${l.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[l.type==="success"?e.jsx(N,{size:16,className:"text-green-600 dark:text-green-400"}):e.jsx(v,{size:16,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-sm ${l.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:l.text})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:[t("login")," *"]}),e.jsx("input",{type:"text",name:"login",value:s.login,onChange:o,required:!0,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text",placeholder:"admin_login"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:[t("password")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",name:"password",value:s.password,onChange:o,required:!0,className:"w-full px-4 py-3 pr-10 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>y(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 theme-text-muted hover:theme-accent",children:m?e.jsx(M,{size:16}):e.jsx($,{size:16})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:[t("fullName")," *"]}),e.jsx("input",{type:"text",name:"full_name",value:s.full_name,onChange:o,required:!0,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text",placeholder:"Admin ismi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("phone")}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:o,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text",placeholder:"+998 90 123 45 67"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:[t("role")," *"]}),e.jsxs("select",{name:"role",value:s.role,onChange:o,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text appearance-none",children:[e.jsx("option",{value:"moderator",children:t("moderatorRole")}),e.jsx("option",{value:"admin",children:t("adminRole")})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 theme-border border theme-text-secondary px-4 py-2 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:t("cancel")}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50",children:t(p?"creating":"create")})]})]})]})}),F&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"theme-bg rounded-2xl theme-shadow-lg theme-border border p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold theme-text",children:t("editAdmin")}),e.jsx("button",{onClick:x,className:"theme-text-secondary hover:theme-text",children:e.jsx(R,{size:20})})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[l.text&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${l.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[l.type==="success"?e.jsx(N,{size:16,className:"text-green-600 dark:text-green-400"}):e.jsx(v,{size:16,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-sm ${l.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:l.text})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("login")}),e.jsx("input",{type:"text",name:"login",value:s.login,onChange:o,required:!0,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("newPasswordHint")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",name:"password",value:s.password,onChange:o,className:"w-full px-4 py-3 pr-10 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text",placeholder:t("newPassword")}),e.jsx("button",{type:"button",onClick:()=>y(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 theme-text-muted hover:theme-accent",children:m?e.jsx(M,{size:16}):e.jsx($,{size:16})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("fullName")}),e.jsx("input",{type:"text",name:"full_name",value:s.full_name,onChange:o,required:!0,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("phone")}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:o,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:t("role")}),e.jsxs("select",{name:"role",value:s.role,onChange:o,disabled:u?.id===c?.id,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text appearance-none disabled:opacity-50",children:[e.jsx("option",{value:"moderator",children:t("moderatorRole")}),e.jsx("option",{value:"admin",children:t("adminRole")})]}),u?.id===c?.id&&e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:t("cannotChangeOwnRole")})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 theme-border border theme-text-secondary px-4 py-2 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:t("cancel")}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50",children:t(p?"saving":"save")})]})]})]})}),c?.role!=="admin"&&e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{size:20,className:"text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold theme-text",children:t("limitedPermission")}),e.jsx("p",{className:"theme-text-secondary text-sm",children:t("moderatorPermissionDesc")})]})]})})]})};export{ye as default};
