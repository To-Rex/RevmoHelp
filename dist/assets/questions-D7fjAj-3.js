import{W as m,l as u,s as a,Z as g}from"./index-BLJsMvxT.js";const _=async e=>{try{if(console.log("❓ Loading questions from Supabase..."),!u()||!a)return console.log("⚠️ Supabase not available"),{data:e?.allowMock===!1?[]:d(),error:null};let t=a.from("questions").select(`
        *,

        category:categories!questions_category_id_fkey(id, name, slug, color)
      `).order("created_at",{ascending:!1});e?.status&&e.status!=="all"&&(t=t.eq("status",e.status)),e?.category_id&&(t=t.eq("category_id",e.category_id)),e?.author_id&&(t=t.eq("author_id",e.author_id)),e?.limit&&(t=t.limit(e.limit)),e?.offset&&(t=t.range(e.offset,e.offset+(e.limit||10)-1));const{data:r,error:o}=await t;return o?(console.log("❌ Supabase error loading questions:",o),{data:e?.allowMock===!1?[]:d(),error:null}):(console.log("✅ Questions loaded from Supabase:",r?.length||0),{data:r,error:null})}catch(t){return console.warn("❓ Error fetching questions from Supabase:",t),{data:e?.allowMock===!1?[]:d(),error:null}}},k=m(_,e=>`questions.${JSON.stringify(e||{})}`,120*1e3),q=async e=>{try{if(!u()||!a){const l=d().find(i=>i.slug===e);return{data:l||null,error:l?null:{message:"Question not found"}}}const{data:t,error:r}=await a.from("questions").select(`
        *,

        category:categories!questions_category_id_fkey(id, name, slug, color)
      `).eq("slug",e).single();if(r)return console.log("❌ Supabase error loading question:",r),{data:d().find(i=>i.slug===e)||null,error:null};await a.from("questions").update({views_count:(t.views_count||0)+1}).eq("id",t.id);const{data:{user:o}}=await a.auth.getUser();if(o){const{data:s}=await a.from("question_votes").select("vote_type").eq("question_id",t.id).eq("user_id",o.id).single();t.user_vote_type=s?.vote_type||null}else t.user_vote_type=null;return{data:t,error:null}}catch(t){return console.warn("❓ Error fetching question by slug:",t),{data:d().find(s=>s.slug===e)||null,error:null}}},v=m(q,e=>`question.${e}`,300*1e3),y=async e=>{try{if(!u()||!a)return{data:f(e),error:null};const{data:t,error:r}=await a.from("answers").select(`
        *,
        author:profiles!answers_author_id_fkey(id, full_name, role, avatar_url)
      `).eq("question_id",e).order("is_best_answer",{ascending:!1}).order("votes_count",{ascending:!1}).order("created_at",{ascending:!0});return r?(console.log("❌ Supabase error loading answers:",r),{data:f(e),error:null}):{data:t,error:null}}catch(t){return console.warn("❓ Error fetching answers:",t),{data:f(e),error:null}}},Q=m(y,e=>`answers.${e}`,120*1e3),p=(e,t,r=5)=>{const s=`${e} ${t}`.toLowerCase().replace(/[^a-zа-яё0-9\s'-]/gi," ").split(/\s+/).filter(Boolean),l=new Set(["va","ham","bilan","uchun","bu","shu","u","ko'p","kam","qanday","qandaydir","bor","yo'q","emas","lekin","yoki","yoki","boshqa","hali","shuningdek","degan","deb","qilib","qilmoq","da","ning","ga","dan","ni","ta","q","bir","ikki","uch","to'rt","besh","oltita","etti","sakkiz","to'qqiz","o'n","и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","есть","если","из","уже","только","мы","такой","еще","для","чтобы","когда","тогда","без","про","ли","быть","the","a","an","and","or","but","if","then","else","for","of","on","in","at","to","from","by","with","is","are","was","were","be","been","being","it","this","that","these","those","as","about","into","over","after","before","between","during","out","up","down"]),i={};for(const n of s){if(n.length<3||l.has(n))continue;const c=n.replace(/^-+|-+$/g,"");c&&(i[c]=(i[c]||0)+1)}return Object.entries(i).sort((n,c)=>c[1]-n[1]).slice(0,r).map(([n])=>n)},S=async e=>{try{if(!u()||!a)throw new Error("Supabase not available");const r=(await a.auth.getUser()).data?.user||null,o=e.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),s=(e.meta_title||e.title).slice(0,60),l=e.content.replace(/\s+/g," ").trim(),i=(e.meta_description||l).slice(0,160),n=e.tags&&e.tags.length>0?e.tags:p(e.title,e.content),c={title:e.title,content:e.content,category_id:e.category_id||null,tags:n,meta_title:s,meta_description:i,slug:`${o}-${Date.now()}`,author_id:r?r.id:null},{data:w,error:h}=await a.from("questions").insert(c).select(`
        *,

        category:categories!questions_category_id_fkey(id, name, slug, color)
      `).single();return h?(console.error("Supabase insert error details:",h),{data:null,error:h}):(g("question"),{data:w,error:null})}catch(t){const r=t instanceof Error?t:t&&typeof t=="object"?JSON.stringify(t):String(t);return console.error("❌ Error creating question:",r),{data:null,error:typeof t=="object"?t:{message:r}}}},E=async e=>{try{if(!u()||!a)throw new Error("Supabase not available");const{data:{user:t}}=await a.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:r}=await a.from("profiles").select("role").eq("id",t.id).single();if(!r||r.role!=="doctor")throw new Error("Only doctors can answer questions");const{data:o,error:s}=await a.from("answers").insert({...e,author_id:t.id}).select(`
        *,
        author:profiles!answers_author_id_fkey(id, full_name, role, avatar_url)
      `).single();if(s)throw s;return g("question"),g(`answers.${e.question_id}`),{data:o,error:null}}catch(t){return console.error("❌ Error creating answer:",t),{data:null,error:t}}},x=async(e,t)=>{try{if(!u()||!a)throw new Error("Supabase not available");const{data:{user:r}}=await a.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:o}=await a.from("question_votes").select("*").eq("question_id",e).eq("user_id",r.id).single();return o?o.vote_type===t?await a.from("question_votes").delete().eq("id",o.id):await a.from("question_votes").update({vote_type:t}).eq("id",o.id):await a.from("question_votes").insert({question_id:e,user_id:r.id,vote_type:t}),g("question"),{error:null}}catch(r){return console.error("❌ Error voting on question:",r),{error:r}}},z=async(e,t)=>{try{if(!u()||!a)throw new Error("Supabase not available");const{data:{user:r}}=await a.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:o}=await a.from("answer_votes").select("*").eq("answer_id",e).eq("user_id",r.id).eq("vote_type",t).single();o?await a.from("answer_votes").delete().eq("id",o.id):await a.from("answer_votes").insert({answer_id:e,user_id:r.id,vote_type:t});const{data:s}=await a.from("answers").select("question_id").eq("id",e).single();return s&&g(`answers.${s.question_id}`),{error:null}}catch(r){return console.error("❌ Error voting on answer:",r),{error:r}}},A=async(e,t)=>{try{if(!u()||!a)throw new Error("Supabase not available");const{data:{user:r}}=await a.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:o}=await a.from("questions").select("author_id").eq("id",e).single(),{data:s}=await a.from("profiles").select("role").eq("id",r.id).single();if(!o||o.author_id!==r.id&&!["admin","moderator"].includes(s?.role))throw new Error("Only question author or admin can mark best answer");return await a.from("answers").update({is_best_answer:!1}).eq("question_id",e),await a.from("answers").update({is_best_answer:!0}).eq("id",t),await a.from("questions").update({best_answer_id:t}).eq("id",e),g("question",e),{error:null}}catch(r){return console.error("❌ Error marking best answer:",r),{error:r}}},R=async()=>{try{if(!u()||!a)return{totalQuestions:156,answeredQuestions:142,totalAnswers:298,totalDoctors:12};const[e,t,r]=await Promise.all([a.from("questions").select("status",{count:"exact"}),a.from("answers").select("id",{count:"exact"}),a.from("profiles").select("id",{count:"exact"}).eq("role","doctor")]),o=e.count||0,s=e.data?.filter(n=>n.status==="answered").length||0,l=t.count||0,i=r.count||0;return{totalQuestions:o,answeredQuestions:s,totalAnswers:l,totalDoctors:i}}catch(e){return console.warn("❓ Error fetching Q&A stats:",e),{totalQuestions:156,answeredQuestions:142,totalAnswers:298,totalDoctors:12}}},d=()=>[{id:"1",title:"Revmatoid artrit belgilari qanday?",content:"Menda qo'llarimda og'riq va shishish bor. Bu revmatoid artrit belgisi bo'lishi mumkinmi? Qanday tekshiruvlar o'tkazish kerak?",slug:"revmatoid-artrit-belgilari",author_id:"user1",author:{id:"user1",full_name:"Aziza Karimova",role:"patient",avatar_url:"https://images.pexels.com/photos/774909/pexels-photo-774909.jpeg?auto=compress&cs=tinysrgb&w=150"},category_id:"cat1",category:{id:"cat1",name:"Artrit",slug:"artrit",color:"#62B6CB"},tags:["artrit","belgilar","diagnostika"],status:"answered",views_count:245,votes_count:12,answers_count:3,best_answer_id:"ans1",created_at:"2024-01-15T10:30:00Z",updated_at:"2024-01-16T14:20:00Z"},{id:"2",title:"Osteoartroz uchun qanday mashqlar foydali?",content:"Tizzalarimda osteoartroz tashxisi qo'yilgan. Qanday jismoniy mashqlar qilishim mumkin va qaysilaridan qochishim kerak?",slug:"osteoartroz-mashqlar",author_id:"user2",author:{id:"user2",full_name:"Bobur Rahimov",role:"patient",avatar_url:"https://images.pexels.com/photos/1222271/pexels-photo-1222271.jpeg?auto=compress&cs=tinysrgb&w=150"},category_id:"cat2",category:{id:"cat2",name:"Artroz",slug:"artroz",color:"#5FA8D3"},tags:["artroz","mashqlar","jismoniy tarbiya"],status:"answered",views_count:189,votes_count:8,answers_count:2,best_answer_id:"ans3",created_at:"2024-01-14T09:15:00Z",updated_at:"2024-01-15T11:45:00Z"},{id:"3",title:"Revmatik kasalliklarni oldini olish mumkinmi?",content:"Oilamda revmatik kasalliklar ko'p uchraydi. Men ham xavf ostidaman. Qanday profilaktika choralari mavjud?",slug:"revmatik-kasalliklar-profilaktika",author_id:"user3",author:{id:"user3",full_name:"Malika Tosheva",role:"patient",avatar_url:"https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?auto=compress&cs=tinysrgb&w=150"},category_id:"cat3",category:{id:"cat3",name:"Profilaktika",slug:"profilaktika",color:"#1B4965"},tags:["profilaktika","genetika","oldini olish"],status:"open",views_count:156,votes_count:15,answers_count:0,created_at:"2024-01-13T16:20:00Z",updated_at:"2024-01-13T16:20:00Z"}],f=e=>e==="1"?[{id:"ans1",content:`Revmatoid artrit belgilari quyidagilarni o'z ichiga oladi:

1. **Ertalabki qotishish** - 30 daqiqadan ortiq davom etadi
2. **Simmetrik bo'g'im og'riqlari** - ikki qo'lda bir xil joyda
3. **Shishish va qizarish**
4. **Umumiy charchoq**

Tekshiruvlar:
- Qon tahlili (RF, anti-CCP)
- Rentgen
- Ultratovush

Albatta revmatolog bilan maslahatlashing.`,question_id:"1",author_id:"doc1",author:{id:"doc1",full_name:"Dr. Shohida Nazarova",role:"doctor",avatar_url:"https://images.pexels.com/photos/5327585/pexels-photo-5327585.jpeg?auto=compress&cs=tinysrgb&w=150"},is_best_answer:!0,votes_count:18,helpful_count:12,created_at:"2024-01-15T14:30:00Z",updated_at:"2024-01-15T14:30:00Z"}]:[];export{R as a,v as b,S as c,Q as d,z as e,E as f,k as g,A as m,x as v};
