import{c as B,u as D,_ as F,r as d,j as e,l as O,s as g}from"./index-DO34fR0A.js";import{S as U}from"./SEOHead-8p3tKIlJ.js";import{C as R}from"./check-circle-DItbFGDG.js";import{A as $}from"./arrow-left-CI2Zj8Yv.js";const H=()=>{const{t}=B(),j=D(),p=F(),[u,w]=d.useState(["","","","","",""]),[N,y]=d.useState(!1),[_,S]=d.useState(""),[k,r]=d.useState(""),[h,V]=d.useState(120),b=d.useRef([]),[v,M]=d.useState(p.state?.session_id||""),[C,T]=d.useState(p.state?.telegram_url||"");d.useEffect(()=>{v||r(t("telegramVerify.sessionIdNotFound"))},[v]),d.useEffect(()=>{if(h>0){const a=setInterval(()=>V(s=>s-1),1e3);return()=>clearInterval(a)}},[h]);const I=async a=>{if(!v){r(t("telegramVerify.sessionIdNotFound"));return}y(!0),r(""),S("");try{const s=await fetch("https://revmohelp.up.railway.app/auth/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({session_id:v,otp:a})}),o=await s.json();if(s.ok){const{access_token:f,refresh_token:m}=o;if(!f||!m){r(t("telegramVerify.invalidResponse"));return}if(!O()||!g){r(t("telegramVerify.authServiceUnavailable"));return}try{const{error:x}=await g.auth.setSession({access_token:f,refresh_token:m});if(x){console.error("Session set error:",x),r(t("telegramVerify.sessionSetError"));return}const{data:{user:c},error:L}=await g.auth.getUser();if(L)console.error("Failed to get user:",L);else if(c){const n=c.raw_user_meta_data||{},l=c.user_metadata||{};let i="";if(n.name?i=n.name:n.display_name?i=n.display_name:n.first_name&&n.last_name?i=`${n.first_name} ${n.last_name}`:n.first_name?i=n.first_name:n.last_name?i=n.last_name:l.name?i=l.name:l.display_name?i=l.display_name:l.first_name&&l.last_name?i=`${l.first_name} ${l.last_name}`:l.first_name?i=l.first_name:l.last_name&&(i=l.last_name),i&&!c.user_metadata?.full_name){const{error:E}=await g.auth.updateUser({data:{full_name:i,phone:p.state?.phone}});E?console.error("Failed to update user metadata:",E):(console.log("Updated user metadata with full_name:",i,"and phone:",p.state?.phone),await g.auth.refreshSession())}}S("Verification successful! Redirecting to home..."),j("/")}catch(x){console.error("Session establishment error:",x),r(t("telegramVerify.sessionSetError"))}}else r(o.message||t("telegramVerify.verificationFailed"))}catch(s){console.error("OTP verification error:",s),r(t("telegramVerify.networkError"))}finally{y(!1)}},z=async()=>{if(!p.state?.phone){r(t("telegramVerify.phoneNotFound"));return}y(!0),r("");try{const a=await fetch("https://revmohelp.up.railway.app/auth/phone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:p.state.phone})}),s=await a.json();a.ok&&s.session_id&&s.telegram_url?(M(s.session_id),T(s.telegram_url),V(120)):r(s.message||t("telegramVerify.resendFailed"))}catch{r(t("telegramVerify.networkError"))}finally{y(!1)}};return d.useEffect(()=>{if(u.every(a=>a!=="")){const a=u.join("");console.log("Verification code:",a),I(a)}},[u]),e.jsxs("div",{className:"min-h-screen theme-bg relative overflow-hidden",children:[e.jsx(U,{title:"Telegram Verification",description:"Verify your Telegram account with a 6-digit code",keywords:"telegram, verification, code, authentication",url:"https://revmohelp.uz/telegram-verify"}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 theme-bg"}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary-100 opacity-20 rounded-full blur-3xl animate-float"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-primary-200 opacity-15 rounded-full blur-3xl animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-green-200 opacity-10 rounded-full blur-2xl animate-pulse-slow"}),e.jsx("div",{className:"absolute inset-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, var(--accent-primary) 1px, transparent 0)",backgroundSize:"40px 40px"}})})]})]}),e.jsx("div",{className:"relative z-10 min-h-screen flex flex-col items-center justify-center px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-sm w-full",children:[e.jsxs("div",{className:"bg-white rounded-3xl theme-shadow-lg theme-border border p-6 animate-zoom-in delay-200",style:{boxShadow:"0 -2px 4px -1px rgba(0, 0, 0, 0.03), 0 -6px 8px -2px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05), 0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:[e.jsxs("div",{className:"text-center animate-fade-in mb-6",children:[e.jsx("div",{className:"flex flex-col items-center space-y-3 mb-6",children:e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center animate-pulse-medical",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"text-white",children:[e.jsx("path",{d:"M22 2L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})}),e.jsx("h2",{className:"text-2xl font-bold theme-text mb-2 animate-slide-up",children:t("telegramVerify.title")}),e.jsx("p",{className:"text-sm theme-text-secondary animate-slide-up delay-100",children:t("telegramVerify.description")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("telegramVerify.codeLabel")}),e.jsx("div",{className:"flex space-x-2 justify-center",children:u.map((a,s)=>e.jsx("input",{ref:o=>b.current[s]=o,type:"text",maxLength:1,pattern:"[0-9]",value:a,onChange:o=>{const f=o.target.value;if(/^\d$/.test(f)||f===""){const m=[...u];m[s]=f,w(m),f&&s<5&&b.current[s+1]?.focus()}},onPaste:o=>{o.preventDefault();const m=o.clipboardData.getData("text").replace(/\D/g,"").slice(0,6),x=[...u];for(let c=0;c<m.length;c++)x[c]=m[c];if(w(x),m.length>0){const c=Math.min(m.length-1,5);b.current[c]?.focus()}},onKeyDown:o=>{o.key==="Backspace"&&!u[s]&&s>0&&b.current[s-1]?.focus()},className:"w-12 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all duration-200 text-center",placeholder:"â€¢",disabled:N},s))}),h>0?e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[t("telegramVerify.resendCodeIn")," ",Math.floor(h/60),":",(h%60).toString().padStart(2,"0")]})}):e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:z,className:"text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors duration-200",children:t("telegramVerify.resendCode")})}),C&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{onClick:()=>window.open(C,"_blank"),className:"w-full border border-gray-200 rounded-lg p-4 bg-white hover:bg-gray-50 cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm6.894 9.072l-1.894 8.928c-.144.672-.534.836-1.076.522l-2.988-2.204-1.442 1.386c-.16.16-.294.294-.604.294l.214-3.034 5.546-5.004c.24-.214-.052-.334-.372-.12L11.77 16.686l-3.008-.936c-.652-.204-.666-.652.136-.964l11.764-4.528c.544-.196.1020-.29.1020-.29z",fill:"#0088cc"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t("telegramVerify.openBotButton")}),e.jsx("p",{className:"text-sm text-gray-600",children:t("telegramVerify.openBotDescription")})]})]})})}),N&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-blue-700 text-sm",children:t("telegramVerify.verifyingCode")})]})}),_&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-green-700 text-sm",children:_})]})}),k&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"text-red-700 text-sm",children:k})})})]})]}),e.jsx("div",{className:"max-w-sm w-full mt-4 text-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>j(-1),className:"flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors duration-200",children:[e.jsx($,{size:20}),e.jsx("span",{children:t("telegramVerify.backButton")})]})})})]})})]})};export{H as default};
