import{l as u,s as e}from"./index-CL5t8gok.js";const f=async(t,r)=>{try{if(!u()||!e)return console.log("âš ï¸ Supabase not available for avatar upload"),URL.createObjectURL(t);console.log("ðŸ“¸ Uploading doctor avatar:",t.name,"for doctor:",r);const a=t.name.split(".").pop(),o=`doctor-avatars/${`${r}-${Date.now()}.${a}`}`,{data:i,error:s}=await e.storage.from("post-images").upload(o,t,{cacheControl:"3600",upsert:!1});if(s)return console.error("âŒ Doctor avatar upload error:",s),console.log("ðŸ”„ Using fallback URL"),URL.createObjectURL(t);console.log("âœ… Doctor avatar uploaded successfully:",i.path);const{data:{publicUrl:l}}=e.storage.from("post-images").getPublicUrl(o);return console.log("ðŸ”— Doctor avatar public URL:",l),l}catch(a){return console.error("âŒ Doctor avatar upload error:",a),console.log("ðŸ”„ Using fallback URL"),URL.createObjectURL(t)}},g=async(t,r="uz")=>{try{if(console.log("ðŸ‘¨â€âš•ï¸ Loading doctor profile for user:",t),!u()||!e)return console.log("âš ï¸ Supabase not available"),{data:null,error:{message:"Supabase not available"}};const{data:a,error:n}=await e.from("doctor_profiles").select(`
        *,
        translations:doctor_profile_translations(*)
      `).eq("user_id",t).maybeSingle();if(n)return console.log("âŒ Error loading doctor profile:",n),{data:null,error:n};const o=a.translations?.find(s=>s.language===r),i=o?{...a,bio:o.bio||a.bio,specialization:o.specialization||a.specialization,education:o.education||a.education,current_language:r}:a;return console.log("âœ… Doctor profile loaded"),{data:i,error:null}}catch(a){return console.error("Error fetching doctor profile:",a),{data:null,error:a}}},_=async(t,r)=>{try{if(!u()||!e)return{data:null,error:{message:"Supabase not available"}};const{data:{user:a}}=await e.auth.getUser();if(!a||a.id!==t)return{data:null,error:{message:"Unauthorized"}};const{data:n,error:o}=await e.from("doctor_profiles").insert({user_id:t,full_name:a.user_metadata?.full_name||a.email?.split("@")[0]||"Doctor",email:a.email||"",phone:a.user_metadata?.phone,specialization:r.specialization,experience_years:r.experience_years,bio:r.bio,avatar_url:void 0,certificates:r.certificates,education:r.education,languages:r.languages,consultation_fee:r.consultation_fee,consultation_duration:r.consultation_duration,working_hours:r.working_hours,verified:!1,active:!1}).select().single();if(o)return{data:null,error:o};if(r.avatar&&n){const i=await f(r.avatar,n.id);if(i){const{data:s,error:l}=await e.from("doctor_profiles").update({avatar_url:i}).eq("id",n.id).select().single();if(l)return{data:null,error:l};Object.assign(n,s)}}if(r.translations){const i=Object.entries(r.translations).map(([l,c])=>({doctor_profile_id:n.id,language:l,bio:c.bio,specialization:c.specialization,education:c.education})),{error:s}=await e.from("doctor_profile_translations").insert(i);s&&console.warn("Warning: Could not create translations:",s)}return console.log("âœ… Doctor profile created"),{data:n,error:null}}catch(a){return{data:null,error:a}}},b=async t=>{try{if(!u()||!e)return{data:null,error:{message:"Supabase not available"}};const{id:r,avatar:a,translations:n,...o}=t;if(a){const l=await f(a,r);l&&(o.avatar_url=l)}const{data:i,error:s}=await e.from("doctor_profiles").update(o).eq("id",r).select().single();if(s)return{data:null,error:s};if(n)for(const[l,c]of Object.entries(n)){const{error:d}=await e.from("doctor_profile_translations").upsert({doctor_profile_id:r,language:l,bio:c.bio,specialization:c.specialization,education:c.education},{onConflict:"doctor_profile_id,language"});d&&console.warn(`Warning: Could not update ${l} translation:`,d)}return console.log("âœ… Doctor profile updated"),{data:i,error:null}}catch(r){return{data:null,error:r}}},m=async(t="uz")=>{try{if(!u()||!e)return{data:[],error:null};const{data:r,error:a}=await e.from("doctor_profiles").select(`
        *,
        translations:doctor_profile_translations(*)
      `).order("created_at",{ascending:!1});return a?{data:null,error:a}:{data:r?.map(o=>{const i=o.translations?.find(s=>s.language===t);return i?{...o,bio:i.bio||o.bio,specialization:i.specialization||o.specialization,education:i.education||o.education,current_language:t}:o})||[],error:null}}catch(r){return{data:null,error:r}}},v=async(t,r)=>{try{if(!u()||!e)return{error:{message:"Supabase not available"}};const{error:a}=await e.from("doctor_profiles").update({verified:r,active:r}).eq("id",t);return{error:a}}catch(a){return{error:a}}};export{g as a,_ as c,m as g,b as u,v};
