import{W as _,Y as g,l as u,s as i,Z as w,g as m}from"./index-BboKWWFL.js";const f=async t=>{try{if(console.log("⭐ Loading rating stats for doctor:",t),!u()||!i)return console.log("⚠️ Supabase not available, using mock data"),d(t);const{data:e,error:r}=await i.from("doctor_reviews").select("rating").eq("doctor_id",t).eq("approved",!0);if(r)return console.log("❌ Supabase error loading rating stats:",r),d(t);if(!e||e.length===0)return console.log("⚠️ No reviews found, using mock data"),d(t);const n=e.length,s=e.reduce((o,v)=>o+v.rating,0)/n,c={1:e.filter(o=>o.rating===1).length,2:e.filter(o=>o.rating===2).length,3:e.filter(o=>o.rating===3).length,4:e.filter(o=>o.rating===4).length,5:e.filter(o=>o.rating===5).length};return console.log("✅ Rating stats loaded from Supabase:",{averageRating:s,totalReviews:n}),{averageRating:Math.round(s*10)/10,totalReviews:n,ratingDistribution:c}}catch(e){return console.warn("⭐ Error fetching rating stats, using mock data:",e),d(t)}},S=_(f,t=>g.doctorRatingStats(t),600*1e3),h=async(t,e)=>{try{if(!u()||!i)return{data:l(t),error:null};let r=i.from("doctor_reviews").select("*").eq("doctor_id",t).order("created_at",{ascending:!1});e?.approved!==void 0&&(r=r.eq("approved",e.approved)),e?.limit&&(r=r.limit(e.limit));const{data:n,error:a}=await r;return a?(console.log("❌ Supabase error loading reviews:",a),{data:l(t),error:null}):{data:n,error:null}}catch(r){return console.warn("⭐ Error fetching reviews, using mock data:",r),{data:l(t),error:null}}},R=_(h,(t,e)=>g.doctorReviews(t,e),300*1e3),b=async t=>{try{if(!u()||!i)return{data:{id:Date.now().toString(),doctor_id:t.doctor_id,rating:t.rating,comment:t.comment,anonymous:t.anonymous||!1,reviewer_name:t.reviewer_name,approved:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},error:null};const{data:{user:e}}=await i.auth.getUser(),{data:r,error:n}=await i.from("doctor_reviews").insert({doctor_id:t.doctor_id,user_id:e?.id,rating:t.rating,comment:t.comment,anonymous:t.anonymous||!1,reviewer_name:e?void 0:t.reviewer_name,approved:!0}).select().single();return w("doctor",t.doctor_id),m.delete(g.doctorRatingStats(t.doctor_id)),m.invalidatePattern(`doctor_reviews.${t.doctor_id}.*`),{data:r,error:n}}catch(e){return{data:null,error:e}}},d=t=>{const r=(t.split("").reduce((s,c)=>s+c.charCodeAt(0),0)*9301+49297)%233280/233280,n=4.5+r*.8,a=Math.floor(50+r*200);return{averageRating:Math.round(n*10)/10,totalReviews:a,ratingDistribution:{1:Math.floor(a*.02),2:Math.floor(a*.03),3:Math.floor(a*.05),4:Math.floor(a*.25),5:Math.floor(a*.65)}}},l=t=>[{id:"1",doctor_id:t,user_id:"user-1",rating:5,comment:"Juda professional shifokor! Menga juda yordam berdi.",reviewer_name:"Malika Karimova",approved:!0,created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()},{id:"2",doctor_id:t,user_id:void 0,rating:5,comment:"Shifokor juda sabr-toqatli va tushuntiradi.",reviewer_name:void 0,approved:!0,created_at:new Date(Date.now()-1728e5).toISOString(),updated_at:new Date(Date.now()-1728e5).toISOString()},{id:"3",doctor_id:t,user_id:"user-3",rating:4,comment:"Yaxshi maslahat berdi, lekin biroz kutish vaqti uzoq edi.",reviewer_name:"Akmal Toshmatov",approved:!0,created_at:new Date(Date.now()-2592e5).toISOString(),updated_at:new Date(Date.now()-2592e5).toISOString()}];export{R as a,b as c,S as g};
