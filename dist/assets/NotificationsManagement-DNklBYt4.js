import{r as l,i as Q,j as e,U as I,F as J,a3 as Z,X as G}from"./index-BboKWWFL.js";import{g as H,d as K,c as V}from"./notifications-ByoOfs6A.js";import{a as W}from"./adminUsers-BMSjbDNk.js";import{P as z}from"./plus-ljUubNkp.js";import{C as q}from"./check-circle-CVKNGZ_0.js";import{A as B}from"./alert-circle-DFhP9NvH.js";import{S as ee}from"./search-DoBKjVgi.js";import{C as te}from"./calendar-N_eVNsIS.js";import{T as se}from"./target-B1EihBiB.js";import{E as re}from"./eye-BBy7w1Jr.js";import{T as ae}from"./trash-2-DRVRt051.js";import{S as le}from"./send-CTJ-CiwY.js";const ye=()=>{const[o,T]=l.useState([]),[g,M]=l.useState([]),[F,D]=l.useState([]),[p,y]=l.useState(!0),[c,L]=l.useState(""),[m,X]=l.useState("all"),[x,O]=l.useState("all"),[P,f]=l.useState(!1),[j,v]=l.useState(!1),[N,k]=l.useState(null),[d,r]=l.useState({type:"",text:""}),[s,w]=l.useState({title:"",message:"",type:"info",target_type:"broadcast",target_user_id:"",post_id:"",expires_at:""});l.useEffect(()=>{h()},[]);const h=async()=>{y(!0);try{const[t,i,a]=await Promise.all([H(),W(),Q("uz",{published:!0})]);t.data&&T(t.data),i.data&&M(i.data),a.data&&D(a.data)}catch{r({type:"error",text:"Ma'lumotlarni yuklashda xatolik"})}finally{y(!1)}},n=t=>{const{name:i,value:a}=t.target;w(b=>({...b,[i]:a})),d.text&&r({type:"",text:""})},_=()=>{w({title:"",message:"",type:"info",target_type:"broadcast",target_user_id:"",post_id:"",expires_at:""})},S=()=>{_(),f(!0)},u=()=>{f(!1),_(),r({type:"",text:""})},$=()=>s.title.trim()?s.message.trim()?s.target_type==="individual"&&!s.target_user_id?(r({type:"error",text:"Shaxsiy xabar uchun foydalanuvchi tanlanishi shart"}),!1):!0:(r({type:"error",text:"Xabar matni kiritilishi shart"}),!1):(r({type:"error",text:"Sarlavha kiritilishi shart"}),!1),E=async t=>{if(t.preventDefault(),!!$()){v(!0),r({type:"",text:""});try{const{data:i,error:a}=await V({...s,target_user_id:s.target_type==="individual"?s.target_user_id:void 0,post_id:s.post_id||void 0,expires_at:s.expires_at||void 0});a?r({type:"error",text:"Xatolik: "+a.message}):(r({type:"success",text:"Bildirishnoma muvaffaqiyatli yuborildi!"}),await h(),setTimeout(()=>{u()},1500))}catch{r({type:"error",text:"Xatolik yuz berdi. Qaytadan urinib ko'ring."})}finally{v(!1)}}},U=async(t,i)=>{if(confirm(`"${i}" bildirishnomani o'chirishni xohlaysizmi?`)){k(t),r({type:"",text:""});try{const{error:a}=await K(t);a?r({type:"error",text:a.message}):(r({type:"success",text:"Bildirishnoma muvaffaqiyatli o'chirildi!"}),await h())}catch{r({type:"error",text:"Xatolik yuz berdi"})}finally{k(null)}}},C=o.filter(t=>{const i=t.title.toLowerCase().includes(c.toLowerCase())||t.message.toLowerCase().includes(c.toLowerCase()),a=m==="all"||t.type===m,b=x==="all"||t.target_type===x;return i&&a&&b}),A=t=>{switch(t){case"success":return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case"warning":return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";case"error":return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";default:return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200"}},R=t=>t==="broadcast"?"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200":"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200",Y=t=>new Date(t).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:"Bildirishnomalar yuklanmoqda..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:"Bildirishnomalar Boshqaruvi"}),e.jsx("p",{className:"theme-text-secondary",children:"Foydalanuvchilarga bildirishnoma yuborish va boshqarish"})]}),e.jsxs("button",{onClick:S,className:"flex items-center space-x-2 theme-accent-bg text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(z,{size:20}),e.jsx("span",{children:"Yangi Bildirishnoma"})]})]}),d.text&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center space-x-2 animate-slide-down ${d.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[d.type==="success"?e.jsx(q,{size:20,className:"text-green-600 dark:text-green-400"}):e.jsx(B,{size:20,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:d.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300",children:d.text})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold theme-text",children:o.length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:"Jami bildirishnomalar"})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.filter(t=>t.target_type==="broadcast").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:"Ommaviy"})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o.filter(t=>t.target_type==="individual").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:"Shaxsiy"})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.filter(t=>t.active).length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:"Faol"})]})]}),e.jsx("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:"Bildirishnomalarni qidiring...",value:c,onChange:t=>L(t.target.value),className:"w-full pl-10 pr-4 py-3 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("select",{value:m,onChange:t=>X(t.target.value),className:"w-full px-4 py-3 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"all",children:"Barcha turlar"}),e.jsx("option",{value:"info",children:"Ma'lumot"}),e.jsx("option",{value:"success",children:"Muvaffaqiyat"}),e.jsx("option",{value:"warning",children:"Ogohlantirish"}),e.jsx("option",{value:"error",children:"Xatolik"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("select",{value:x,onChange:t=>O(t.target.value),className:"w-full px-4 py-3 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"all",children:"Barcha maqsadlar"}),e.jsx("option",{value:"broadcast",children:"Ommaviy"}),e.jsx("option",{value:"individual",children:"Shaxsiy"})]})})]})}),e.jsx("div",{className:"space-y-4",children:C.map(t=>e.jsx("div",{className:"theme-bg rounded-xl theme-shadow hover:theme-shadow-lg transition-all duration-300 theme-border border p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${A(t.type)}`,children:t.type}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${R(t.target_type)}`,children:t.target_type==="broadcast"?"Ommaviy":"Shaxsiy"}),t.post&&e.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full",children:"Maqola bilan"})]}),e.jsx("h3",{className:"text-lg font-bold theme-text mb-2",children:t.title}),e.jsx("p",{className:"theme-text-secondary mb-4 line-clamp-2",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between text-sm theme-text-muted",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(I,{size:14}),e.jsx("span",{children:t.creator?.full_name||"System"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(te,{size:14}),e.jsx("span",{children:Y(t.sent_at)})]}),t.target_type==="individual"&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(se,{size:14}),e.jsx("span",{children:g.find(i=>i.id===t.target_user_id)?.full_name||"Foydalanuvchi"})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(re,{size:14}),e.jsxs("span",{children:[t.read_by?.length||0," o'qilgan"]})]})]}),t.post&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{size:16,className:"text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:["Bog'langan maqola: ",t.post.title]})]})})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:e.jsx("button",{onClick:()=>U(t.id,t.title),disabled:N===t.id,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900 transition-colors duration-200 disabled:opacity-50",children:N===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(ae,{size:16})})})]})},t.id))}),C.length===0&&!p&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(Z,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold theme-text-secondary mb-2",children:"Bildirishnoma topilmadi"}),e.jsx("p",{className:"theme-text-muted mb-6",children:"Qidiruv so'zini o'zgartiring yoki yangi bildirishnoma yarating"}),e.jsxs("button",{onClick:S,className:"inline-flex items-center space-x-2 theme-accent-bg text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(z,{size:20}),e.jsx("span",{children:"Birinchi bildirishnomani yaratish"})]})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"theme-bg rounded-2xl theme-shadow-lg theme-border border p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold theme-text",children:"Yangi Bildirishnoma"}),e.jsx("button",{onClick:u,className:"theme-text-secondary hover:theme-text p-1 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:e.jsx(G,{size:20})})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[d.text&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${d.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[d.type==="success"?e.jsx(q,{size:16,className:"text-green-600 dark:text-green-400"}):e.jsx(B,{size:16,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-sm ${d.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:d.text})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Sarlavha *"}),e.jsx("input",{type:"text",name:"title",value:s.title,onChange:n,required:!0,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",placeholder:"Bildirishnoma sarlavhasi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Turi *"}),e.jsxs("select",{name:"type",value:s.type,onChange:n,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"info",children:"Ma'lumot"}),e.jsx("option",{value:"success",children:"Muvaffaqiyat"}),e.jsx("option",{value:"warning",children:"Ogohlantirish"}),e.jsx("option",{value:"error",children:"Xatolik"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Maqsad *"}),e.jsxs("select",{name:"target_type",value:s.target_type,onChange:n,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"broadcast",children:"Ommaviy (barcha foydalanuvchilar)"}),e.jsx("option",{value:"individual",children:"Shaxsiy (bitta foydalanuvchi)"})]})]}),s.target_type==="individual"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Foydalanuvchi *"}),e.jsxs("select",{name:"target_user_id",value:s.target_user_id,onChange:n,required:!0,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"",children:"Foydalanuvchini tanlang"}),g.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Bog'langan maqola (ixtiyoriy)"}),e.jsxs("select",{name:"post_id",value:s.post_id,onChange:n,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"",children:"Maqola tanlanmagan"}),F.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Amal qilish muddati (ixtiyoriy)"}),e.jsx("input",{type:"datetime-local",name:"expires_at",value:s.expires_at,onChange:n,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:"Xabar matni *"}),e.jsx("textarea",{name:"message",value:s.message,onChange:n,required:!0,rows:4,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text resize-none",placeholder:"Bildirishnoma matnini kiriting..."}),e.jsxs("div",{className:"text-xs theme-text-muted mt-1",children:[s.message.length,"/500 belgi"]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 theme-border border theme-text-secondary px-4 py-3 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:"Bekor qilish"}),e.jsxs("button",{type:"submit",disabled:j,className:"flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 flex items-center justify-center space-x-2",children:[e.jsx(le,{size:18}),e.jsx("span",{children:j?"Yuborilmoqda...":"Yuborish"})]})]})]})]})})]})};export{ye as default};
