import{c as H,r as i,i as J,j as e,t as K,U as Q,F as V,a3 as Y,X as ee}from"./index-Z4L9-lCG.js";import{g as te,d as se,c as re}from"./notifications-CFpNznnB.js";import{a as ae}from"./adminUsers-CV6YUzrj.js";import{P as E}from"./plus-BHSJqwky.js";import{C as M}from"./check-circle-DJqXdf__.js";import{A}from"./alert-circle-CdBNdKG8.js";import{S as ie}from"./search-Bw7LNGH_.js";import{C as le}from"./calendar-92JDbxfr.js";import{T as ne}from"./target-MBCZBerS.js";import{E as oe}from"./eye--hYI9hvJ.js";import{T as de}from"./trash-2-PiHk2pnV.js";import{S as ce}from"./send-BWiBKd4Z.js";const we=()=>{const{t:s}=H(),[c,P]=i.useState([]),[j,I]=i.useState([]),[U,R]=i.useState([]),[v,N]=i.useState(!0),[u,$]=i.useState(""),[h,F]=i.useState("all"),[x,g]=i.useState("all"),[q,w]=i.useState(!1),[k,T]=i.useState(!1),[_,C]=i.useState(null),[o,a]=i.useState({type:"",text:""}),[p,m]=i.useState(!1),[r,S]=i.useState({title:"",message:"",type:"info",target_type:"broadcast",target_user_id:"",post_id:"",expires_at:""});i.useEffect(()=>{b()},[]);const b=async()=>{N(!0);try{const[t,n,l]=await Promise.all([te(),ae(),J("uz",{published:!0})]);t.data&&P(t.data),n.data&&I(n.data),l.data&&R(l.data)}catch{a({type:"error",text:s("notificationsDataLoadingError")})}finally{N(!1)}},d=t=>{const{name:n,value:l}=t.target;S(y=>({...y,[n]:l})),o.text&&a({type:"",text:""})},z=()=>{S({title:"",message:"",type:"info",target_type:"broadcast",target_user_id:"",post_id:"",expires_at:""})},L=()=>{z(),w(!0)},f=()=>{w(!1),z(),a({type:"",text:""})},B=()=>r.title.trim()?r.message.trim()?r.target_type==="individual"&&!r.target_user_id?(a({type:"error",text:s("notificationsUserRequired")}),!1):!0:(a({type:"error",text:s("notificationsMessageRequired")}),!1):(a({type:"error",text:s("notificationsTitleRequired")}),!1),O=async t=>{if(t.preventDefault(),!!B()){T(!0),a({type:"",text:""});try{const{data:n,error:l}=await re({...r,target_user_id:r.target_type==="individual"?r.target_user_id:void 0,post_id:r.post_id||void 0,expires_at:r.expires_at||void 0});l?a({type:"error",text:s("notificationsGeneralError")+": "+l.message}):(a({type:"success",text:s("notificationsSent")}),await b(),setTimeout(()=>{f()},1500))}catch{a({type:"error",text:s("notificationsGeneralError")})}finally{T(!1)}}},W=async(t,n)=>{if(confirm(`"${n}" ${s("notificationsConfirmDelete")}`)){C(t),a({type:"",text:""});try{const{error:l}=await se(t);l?a({type:"error",text:l.message}):(a({type:"success",text:s("notificationsDeleted")}),await b())}catch{a({type:"error",text:s("notificationsGeneralError")})}finally{C(null)}}},D=c.filter(t=>{const n=t.title.toLowerCase().includes(u.toLowerCase())||t.message.toLowerCase().includes(u.toLowerCase()),l=h==="all"||t.type===h,y=x==="all"||t.target_type===x;return n&&l&&y}),G=t=>{switch(t){case"success":return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case"warning":return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";case"error":return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";default:return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200"}},X=t=>t==="broadcast"?"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200":"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200",Z=t=>new Date(t).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return v?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:s("notificationsLoading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:s("notificationsManagementTitle")}),e.jsx("p",{className:"theme-text-secondary",children:s("notificationsManagementDesc")})]}),e.jsxs("button",{onClick:L,className:"flex items-center space-x-2 theme-accent-bg text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(E,{size:20}),e.jsx("span",{children:s("notificationsNewNotification")})]})]}),o.text&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center space-x-2 animate-slide-down ${o.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[o.type==="success"?e.jsx(M,{size:20,className:"text-green-600 dark:text-green-400"}):e.jsx(A,{size:20,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:o.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300",children:o.text})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold theme-text",children:c.length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:s("notificationsTotal")})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.filter(t=>t.target_type==="broadcast").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:s("notificationsBroadcast")})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:c.filter(t=>t.target_type==="individual").length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:s("notificationsIndividual")})]}),e.jsxs("div",{className:"theme-bg rounded-xl theme-shadow theme-border border p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(t=>t.active).length}),e.jsx("div",{className:"text-sm theme-text-secondary",children:s("notificationsActive")})]})]}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4 lg:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 lg:gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:18}),e.jsx("input",{type:"text",placeholder:s("notificationsSearch"),value:u,onChange:t=>$(t.target.value),className:"w-full pl-10 pr-4 py-2 lg:py-3 bg-gray-50 border border-gray-200 rounded-lg focus:border-blue-500 transition-all duration-200 theme-text text-sm"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("select",{value:h,onChange:t=>F(t.target.value),className:"w-full px-3 lg:px-4 py-2 lg:py-3 bg-gray-50 border border-gray-200 rounded-lg focus:border-blue-500 transition-all duration-200 theme-text text-sm",children:[e.jsx("option",{value:"all",children:s("notificationsAllTypes")}),e.jsx("option",{value:"info",children:s("notificationsInfoType")}),e.jsx("option",{value:"success",children:s("notificationsSuccessType")}),e.jsx("option",{value:"warning",children:s("notificationsWarningType")}),e.jsx("option",{value:"error",children:s("notificationsErrorType")})]})}),e.jsxs("div",{className:"lg:w-48 relative",children:[e.jsxs("button",{onClick:t=>{t.stopPropagation(),m(!p)},className:"w-full px-3 lg:px-4 py-2 lg:py-3 bg-gray-50 border border-gray-200 rounded-lg focus:border-blue-500 transition-all duration-200 theme-text text-sm text-left flex items-center justify-between",children:[e.jsx("span",{children:s(x==="all"?"notificationsAllTargets":x==="broadcast"?"notificationsBroadcastTarget":"notificationsIndividualTarget")}),e.jsx(K,{className:`theme-text-muted transition-transform ${p?"rotate-180":""}`,size:16})]}),p&&e.jsxs("div",{onClick:t=>t.stopPropagation(),className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:[e.jsx("div",{onClick:()=>{g("all"),m(!1)},className:"px-4 py-2 hover:bg-gray-50 cursor-pointer theme-text",children:s("notificationsAllTargets")}),e.jsx("div",{onClick:()=>{g("broadcast"),m(!1)},className:"px-4 py-2 hover:bg-gray-50 cursor-pointer theme-text",children:s("notificationsBroadcastTarget")}),e.jsx("div",{onClick:()=>{g("individual"),m(!1)},className:"px-4 py-2 hover:bg-gray-50 cursor-pointer theme-text",children:s("notificationsIndividualTarget")})]})]})]})}),e.jsx("div",{className:"space-y-4",children:D.map(t=>e.jsx("div",{className:"theme-bg rounded-xl theme-shadow hover:theme-shadow-lg transition-all duration-300 theme-border border p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${G(t.type)}`,children:t.type==="info"?s("notificationsInfoType"):t.type==="success"?s("notificationsSuccessType"):t.type==="warning"?s("notificationsWarningType"):s("notificationsErrorType")}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${X(t.target_type)}`,children:t.target_type==="broadcast"?s("notificationsBroadcastTarget"):s("notificationsIndividualTarget")}),t.post&&e.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full",children:s("notificationsWithArticle")})]}),e.jsx("h3",{className:"text-lg font-bold theme-text mb-2",children:t.title}),e.jsx("p",{className:"theme-text-secondary mb-4 line-clamp-2",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between text-sm theme-text-muted",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{size:14}),e.jsx("span",{children:t.creator?.full_name||s("notificationsSystem")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(le,{size:14}),e.jsx("span",{children:Z(t.sent_at)})]}),t.target_type==="individual"&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ne,{size:14}),e.jsx("span",{children:j.find(n=>n.id===t.target_user_id)?.full_name||s("notificationsUser")})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(oe,{size:14}),e.jsxs("span",{children:[t.read_by?.length||0," ",s("notificationsReadCount")]})]})]}),t.post&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{size:16,className:"text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:[s("notificationsLinkedArticle"),": ",t.post.title]})]})})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:e.jsx("button",{onClick:()=>W(t.id,t.title),disabled:_===t.id,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900 transition-colors duration-200 disabled:opacity-50",children:_===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(de,{size:16})})})]})},t.id))}),D.length===0&&!v&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(Y,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold theme-text-secondary mb-2",children:s("notificationsNotFound")}),e.jsx("p",{className:"theme-text-muted mb-6",children:s("notificationsChangeSearchOrCreate")}),e.jsxs("button",{onClick:L,className:"inline-flex items-center space-x-2 theme-accent-bg text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(E,{size:20}),e.jsx("span",{children:s("notificationsCreateFirst")})]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"theme-bg rounded-2xl theme-shadow-lg theme-border border p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold theme-text",children:s("notificationsNewModal")}),e.jsx("button",{onClick:f,className:"theme-text-secondary hover:theme-text p-1 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:e.jsx(ee,{size:20})})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[o.text&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${o.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[o.type==="success"?e.jsx(M,{size:16,className:"text-green-600 dark:text-green-400"}):e.jsx(A,{size:16,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-sm ${o.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:o.text})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsTitleLabel")}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:d,required:!0,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",placeholder:s("notificationsTitlePlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsTypeLabel")}),e.jsxs("select",{name:"type",value:r.type,onChange:d,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"info",children:s("notificationsInfoType")}),e.jsx("option",{value:"success",children:s("notificationsSuccessType")}),e.jsx("option",{value:"warning",children:s("notificationsWarningType")}),e.jsx("option",{value:"error",children:s("notificationsErrorType")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsTargetLabel")}),e.jsxs("select",{name:"target_type",value:r.target_type,onChange:d,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"broadcast",children:s("notificationsBroadcastOption")}),e.jsx("option",{value:"individual",children:s("notificationsIndividualOption")})]})]}),r.target_type==="individual"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsUserLabel")}),e.jsxs("select",{name:"target_user_id",value:r.target_user_id,onChange:d,required:!0,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"",children:s("notificationsSelectUser")}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsLinkedArticleLabel")}),e.jsxs("select",{name:"post_id",value:r.post_id,onChange:d,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text",children:[e.jsx("option",{value:"",children:s("notificationsNoArticleSelected")}),U.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsExpirationLabel")}),e.jsx("input",{type:"datetime-local",name:"expires_at",value:r.expires_at,onChange:d,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-secondary mb-2",children:s("notificationsMessageLabel")}),e.jsx("textarea",{name:"message",value:r.message,onChange:d,required:!0,rows:4,className:"w-full px-3 py-2 theme-border border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 theme-bg theme-text resize-none",placeholder:s("notificationsMessagePlaceholder")}),e.jsxs("div",{className:"text-xs theme-text-muted mt-1",children:[r.message.length,"/500"]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:f,className:"flex-1 theme-border border theme-text-secondary px-4 py-3 rounded-lg hover:theme-bg-tertiary transition-colors duration-200",children:s("cancel")}),e.jsxs("button",{type:"submit",disabled:k,className:"flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 flex items-center justify-center space-x-2",children:[e.jsx(ce,{size:18}),e.jsx("span",{children:s(k?"notificationsSending":"notificationsSend")})]})]})]})]})})]})};export{we as default};
