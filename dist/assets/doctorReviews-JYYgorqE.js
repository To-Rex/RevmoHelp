import{W as u,Y as c,l as g,s as i,Z as v,g as l}from"./index-DtX8_sFx.js";const w=async t=>{try{if(console.log("⭐ Loading rating stats for doctor:",t),!g()||!i)return console.log("⚠️ Supabase not available, using mock data"),f(t);const{data:e,error:r}=await i.from("doctor_reviews").select("rating").eq("doctor_id",t).eq("approved",!0);if(r)return console.log("❌ Supabase error loading rating stats:",r),{averageRating:0,totalReviews:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}};if(!e||e.length===0)return console.log("⚠️ No reviews found for doctor"),{averageRating:0,totalReviews:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}};const n=e.length,s=e.reduce((o,m)=>o+m.rating,0)/n,d={1:e.filter(o=>o.rating===1).length,2:e.filter(o=>o.rating===2).length,3:e.filter(o=>o.rating===3).length,4:e.filter(o=>o.rating===4).length,5:e.filter(o=>o.rating===5).length};return console.log("✅ Rating stats loaded from Supabase:",{averageRating:s,totalReviews:n}),{averageRating:Math.round(s*10)/10,totalReviews:n,ratingDistribution:d}}catch(e){return console.warn("⭐ Error fetching rating stats:",e),{averageRating:0,totalReviews:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}}}},R=u(w,t=>c.doctorRatingStats(t),600*1e3),_=async(t,e)=>{try{if(!g()||!i)return{data:h(t),error:null};let r=i.from("doctor_reviews").select("*").eq("doctor_id",t).order("created_at",{ascending:!1});e?.approved!==void 0&&(r=r.eq("approved",e.approved)),e?.limit&&(r=r.limit(e.limit));const{data:n,error:a}=await r;return a?(console.log("❌ Supabase error loading reviews:",a),{data:[],error:null}):{data:n,error:null}}catch(r){return console.warn("⭐ Error fetching reviews:",r),{data:[],error:null}}},S=u(_,(t,e)=>c.doctorReviews(t,e),300*1e3),b=async t=>{try{if(!g()||!i)return{data:{id:Date.now().toString(),doctor_id:t.doctor_id,rating:t.rating,comment:t.comment,anonymous:t.anonymous||!1,reviewer_name:t.reviewer_name,approved:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},error:null};const{data:{user:e}}=await i.auth.getUser(),{data:r,error:n}=await i.from("doctor_reviews").insert({doctor_id:t.doctor_id,user_id:e?.id,rating:t.rating,comment:t.comment,anonymous:t.anonymous||!1,reviewer_name:e?void 0:t.reviewer_name,approved:!0}).select().single();return v("doctor",t.doctor_id),l.delete(c.doctorRatingStats(t.doctor_id)),l.invalidatePattern(`doctor_reviews.${t.doctor_id}.*`),{data:r,error:n}}catch(e){return{data:null,error:e}}},f=t=>{const r=(t.split("").reduce((s,d)=>s+d.charCodeAt(0),0)*9301+49297)%233280/233280,n=4.5+r*.8,a=Math.floor(50+r*200);return{averageRating:Math.round(n*10)/10,totalReviews:a,ratingDistribution:{1:Math.floor(a*.02),2:Math.floor(a*.03),3:Math.floor(a*.05),4:Math.floor(a*.25),5:Math.floor(a*.65)}}},h=t=>[{id:"1",doctor_id:t,user_id:"user-1",rating:5,comment:"Juda professional shifokor! Menga juda yordam berdi.",anonymous:!1,reviewer_name:"Malika Karimova",approved:!0,created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()},{id:"2",doctor_id:t,user_id:void 0,rating:5,comment:"Shifokor juda sabr-toqatli va tushuntiradi.",anonymous:!0,reviewer_name:void 0,approved:!0,created_at:new Date(Date.now()-1728e5).toISOString(),updated_at:new Date(Date.now()-1728e5).toISOString()},{id:"3",doctor_id:t,user_id:"user-3",rating:4,comment:"Yaxshi maslahat berdi, lekin biroz kutish vaqti uzoq edi.",anonymous:!1,reviewer_name:"Akmal Toshmatov",approved:!0,created_at:new Date(Date.now()-2592e5).toISOString(),updated_at:new Date(Date.now()-2592e5).toISOString()}];export{S as a,b as c,R as g};
