import{l as R,s as N,j as e,f as B,G as F,r as o,S as M,U as I,a as K}from"./index-CL5t8gok.js";import{g as E,a as H,d as X}from"./adminUsers-LOdMDUMn.js";import{S as U}from"./search-CyuOeQuV.js";import{C as z}from"./check-circle-B-lh5xiC.js";import{A as D}from"./alert-circle-CZib7xpJ.js";import{C as L}from"./clock-wiaMoHKP.js";import{S as G}from"./square-pen-CAyPzhwE.js";import{E as Q}from"./eye-DiwoFZST.js";import{T as P}from"./trash-2-B_MHJ-Qf.js";import{M as T}from"./mail-BhmN_XPR.js";import{U as Y}from"./user-check-Jary3faw.js";import{P as _}from"./phone-BdTei3Se.js";import{C as J}from"./calendar-IMD9toLQ.js";import{M as A}from"./message-square-CqUK5yK-.js";import{X as $}from"./x-circle-fkDoxeS_.js";import{T as Z}from"./trending-up-DwQmW9Qz.js";import{F as V}from"./filter-Co0Xv8KA.js";const O=async r=>{try{if(console.log("ðŸ“‹ Loading consultation requests from Supabase..."),!R()||!N)return console.log("âš ï¸ Supabase not available, using mock data"),{data:q(),error:null};let i=N.from("consultation_requests").select("*").order("created_at",{ascending:!1});r?.status&&r.status,r?.limit;const{data:s,error:c}=await i;return c?(console.log("âŒ Supabase error loading consultation requests:",c),console.log("ðŸ”„ Falling back to mock data"),{data:q(),error:null}):(console.log("âœ… Consultation requests loaded from Supabase:",s?.length||0),{data:s,error:null})}catch(i){return console.warn("ðŸ“‹ Error fetching consultation requests from Supabase, using mock data:",i),{data:q(),error:null}}},W=async r=>{try{if(!R()||!N)return{data:null,error:{message:"Supabase not available"}};const{id:i,...s}=r,{data:c,error:h}=await N.from("consultation_requests").update(s).eq("id",i).select().single();return{data:c,error:h}}catch(i){return{data:null,error:i}}},ee=async r=>{try{if(!R()||!N)return{error:{message:"Supabase not available"}};const{error:i}=await N.from("consultation_requests").delete().eq("id",r);return{error:i}}catch(i){return{error:i}}},q=()=>[{id:"1",first_name:"Malika",last_name:"Karimova",age:45,disease_type:"Revmatoid artrit",phone:"+998901234567",comments:"Qo'llarimda og'riq va shishish bor. Ertalab qotishlik kuchli.",status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"2",first_name:"Akmal",last_name:"Toshmatov",age:52,disease_type:"Osteoartroz",phone:"+998901234568",comments:"Tizza og'riqlari, ayniqsa yurish paytida kuchayadi.",status:"contacted",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()},{id:"3",first_name:"Nodira",last_name:"Abdullayeva",age:38,disease_type:"Fibromyalgiya",phone:"+998901234569",comments:"Butun vujudda og'riq, charchoq va uyqu buzilishi.",status:"completed",created_at:new Date(Date.now()-1728e5).toISOString(),updated_at:new Date(Date.now()-1728e5).toISOString()}],te=({searchTerm:r,selectedRole:i,selectedProvider:s,onSearchChange:c,onRoleChange:h,onProviderChange:g,userCounts:m})=>{const y=[{value:"all",label:"Barcha rollar",count:m.total},{value:"admin",label:"Admin",count:m.byRole.admin||0},{value:"moderator",label:"Moderator",count:m.byRole.moderator||0},{value:"doctor",label:"Shifokor",count:m.byRole.doctor||0},{value:"patient",label:"Bemor",count:m.byRole.patient||0}],p=[{value:"all",label:"Barcha providerlar",count:m.total},{value:"email",label:"Email",count:m.byProvider.email||0},{value:"google",label:"Google",count:m.byProvider.google||0}];return e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:"Foydalanuvchilarni qidiring...",value:r,onChange:n=>c(n.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]})}),e.jsx("div",{className:"lg:w-56",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("select",{value:i,onChange:n=>h(n.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 appearance-none theme-text",children:y.map(n=>e.jsxs("option",{value:n.value,children:[n.label," (",n.count,")"]},n.value))})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("select",{value:s,onChange:n=>g(n.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 appearance-none theme-text",children:p.map(n=>e.jsxs("option",{value:n.value,children:[n.label," (",n.count,")"]},n.value))})]})})]})})},ae=({searchTerm:r,selectedRole:i,selectedProvider:s})=>{const[c,h]=o.useState([]),[g,m]=o.useState([]),[y,p]=o.useState(!0),[n,u]=o.useState(null),[d,x]=o.useState({type:"",text:""});o.useEffect(()=>{v()},[]);const v=async()=>{p(!0);try{const[t,a]=await Promise.all([E(),H()]);t.data&&h(t.data),a.data&&m(a.data)}catch(t){console.error("Error loading users:",t),x({type:"error",text:"Foydalanuvchilarni yuklashda xatolik"})}finally{p(!1)}},j=async(t,a)=>{if(confirm(`${a} foydalanuvchisini o'chirishni xohlaysizmi?`)){u(t),x({type:"",text:""});try{const{error:l}=await X(t);l?x({type:"error",text:l.message}):(x({type:"success",text:"Foydalanuvchi muvaffaqiyatli o'chirildi!"}),await v())}catch{x({type:"error",text:"Xatolik yuz berdi"})}finally{u(null)}}},f=c.map(t=>{const a=g.find(l=>l.id===t.id);return{...t,profile:a,full_name:a?.full_name||t.user_metadata?.full_name||t.user_metadata?.name||t.email?.split("@")[0]||"User",role:a?.role||t.user_metadata?.role||"patient",phone:a?.phone||t.user_metadata?.phone||t.phone,avatar_url:a?.avatar_url||t.user_metadata?.avatar_url||t.user_metadata?.picture}}).filter(t=>{const a=t.full_name.toLowerCase().includes(r.toLowerCase())||t.email.toLowerCase().includes(r.toLowerCase()),l=i==="all"||t.role===i,b=s==="all"||t.app_metadata?.provider===s;return a&&l&&b}),k=t=>{switch(t){case"admin":return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";case"moderator":return"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200";case"doctor":return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200";case"patient":return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},S=t=>{switch(t){case"google":return e.jsx("div",{className:"w-4 h-4 bg-white rounded-full flex items-center justify-center shadow-sm",children:e.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]})});case"email":return e.jsx(T,{size:16,className:"text-blue-600"});default:return e.jsx(M,{size:16,className:"text-gray-600"})}},C=t=>new Date(t).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return y?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:"Foydalanuvchilar yuklanmoqda..."})]})}):e.jsxs("div",{className:"space-y-6",children:[d.text&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center space-x-2 animate-slide-down ${d.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[d.type==="success"?e.jsx(z,{size:20,className:"text-green-600 dark:text-green-400"}):e.jsx(D,{size:20,className:"text-red-600 dark:text-red-400"}),e.jsx("span",{className:d.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300",children:d.text})]}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y theme-border",children:[e.jsx("thead",{className:"theme-bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Foydalanuvchi"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Rol"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Provider"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Telefon"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Oxirgi kirish"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Holat"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Amallar"})]})}),e.jsx("tbody",{className:"theme-bg divide-y theme-border",children:f.map(t=>e.jsxs("tr",{className:"hover:theme-bg-tertiary transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.full_name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"theme-accent font-medium text-sm",children:t.full_name.charAt(0)})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium theme-text",children:t.full_name}),e.jsx("div",{className:"text-sm theme-text-muted",children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full capitalize ${k(t.role)}`,children:t.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[S(t.app_metadata?.provider||"email"),e.jsx("span",{className:"text-sm theme-text capitalize",children:t.app_metadata?.provider||"email"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm theme-text",children:t.phone||"Kiritilmagan"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm theme-text-muted",children:t.last_sign_in_at?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(L,{size:14}),e.jsx("span",{children:C(t.last_sign_in_at)})]}):"Hech qachon"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.email_confirmed_at?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"}`,children:t.email_confirmed_at?"Tasdiqlangan":"Tasdiqlanmagan"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{className:"theme-accent hover:text-blue-900 dark:hover:text-blue-300 p-1 rounded",children:e.jsx(G,{size:16})}),e.jsx("button",{className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300 p-1 rounded",children:e.jsx(Q,{size:16})}),e.jsx("button",{onClick:()=>j(t.id,t.full_name),disabled:n===t.id,className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 p-1 rounded disabled:opacity-50",children:n===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(P,{size:16})})]})})]},t.id))})]})})}),f.length===0&&!y&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(U,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold theme-text-secondary mb-2",children:"Foydalanuvchi topilmadi"}),e.jsx("p",{className:"theme-text-muted",children:"Qidiruv so'zini o'zgartiring yoki filtrlarni qayta sozlang"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm theme-text-secondary",children:[f.length," ta foydalanuvchi ko'rsatilmoqda"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-4 py-2 theme-border border rounded-lg hover:theme-bg-tertiary transition-colors duration-200 theme-text-secondary",children:"Oldingi"}),e.jsx("button",{className:"px-4 py-2 theme-accent-bg text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"1"}),e.jsx("button",{className:"px-4 py-2 theme-border border rounded-lg hover:theme-bg-tertiary transition-colors duration-200 theme-text-secondary",children:"Keyingi"})]})]})]})},re=({stats:r})=>{const i=[{name:"Jami Foydalanuvchilar",value:r.total.toLocaleString(),icon:B,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Tasdiqlangan",value:r.confirmed.toLocaleString(),icon:Y,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Email Foydalanuvchilar",value:r.emailUsers.toLocaleString(),icon:T,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Google Foydalanuvchilar",value:r.googleUsers.toLocaleString(),icon:F,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Oxirgi 7 kun",value:r.recentSignups.toLocaleString(),icon:L,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Tasdiqlanmagan",value:r.unconfirmed.toLocaleString(),icon:M,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"}];return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:i.map(s=>{const c=s.icon;return e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4 hover:theme-shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${s.bgColor}`,children:e.jsx(c,{size:20,className:s.textColor})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold theme-text mb-1",children:s.value}),e.jsx("p",{className:"text-xs theme-text-secondary",children:s.name})]})]},s.name)})})},se=({searchTerm:r,selectedStatus:i})=>{const[s,c]=o.useState([]),[h,g]=o.useState(!0),[m,y]=o.useState(null),[p,n]=o.useState(null),[u,d]=o.useState({type:"",text:""});o.useEffect(()=>{x()},[]);const x=async()=>{g(!0);try{const{data:t}=await O();t&&c(t)}catch(t){console.error("Error loading consultation requests:",t),d({type:"error",text:"Maslahat so'rovlarini yuklashda xatolik"})}finally{g(!1)}},v=async(t,a)=>{y(t),d({type:"",text:""});try{const{error:l}=await W({id:t,status:a});l?d({type:"error",text:l.message}):(d({type:"success",text:"Holat muvaffaqiyatli yangilandi!"}),await x())}catch{d({type:"error",text:"Xatolik yuz berdi"})}finally{y(null)}},j=async(t,a)=>{if(confirm(`${a}ning so'rovini o'chirishni xohlaysizmi?`)){n(t),d({type:"",text:""});try{const{error:l}=await ee(t);l?d({type:"error",text:l.message}):(d({type:"success",text:"So'rov muvaffaqiyatli o'chirildi!"}),await x())}catch{d({type:"error",text:"Xatolik yuz berdi"})}finally{n(null)}}},w=s.filter(t=>{const a=t.first_name.toLowerCase().includes(r.toLowerCase())||t.last_name.toLowerCase().includes(r.toLowerCase())||t.disease_type.toLowerCase().includes(r.toLowerCase())||t.phone.includes(r),l=i==="all"||t.status===i;return a&&l}),f=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"contacted":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},k=t=>{switch(t){case"pending":return L;case"contacted":return _;case"completed":return z;case"cancelled":return $;default:return D}},S=t=>{switch(t){case"pending":return"Kutilmoqda";case"contacted":return"Bog'lanildi";case"completed":return"Yakunlandi";case"cancelled":return"Bekor qilindi";default:return"Noma'lum"}},C=t=>new Date(t).toLocaleDateString("uz-UZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return h?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:"Maslahat so'rovlari yuklanmoqda..."})]})}):e.jsxs("div",{className:"space-y-6",children:[u.text&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center space-x-2 animate-slide-down ${u.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[u.type==="success"?e.jsx(z,{size:20,className:"text-green-600"}):e.jsx(D,{size:20,className:"text-red-600"}),e.jsx("span",{className:u.type==="success"?"text-green-700":"text-red-700",children:u.text})]}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y theme-border",children:[e.jsx("thead",{className:"theme-bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Bemor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Kasallik"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Telefon"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Holat"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium theme-text-muted uppercase tracking-wider",children:"So'ralgan vaqt"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium theme-text-muted uppercase tracking-wider",children:"Amallar"})]})}),e.jsx("tbody",{className:"theme-bg divide-y theme-border",children:w.map(t=>{const a=k(t.status);return e.jsxs("tr",{className:"hover:theme-bg-tertiary transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(I,{size:16,className:"theme-accent"})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"text-sm font-medium theme-text",children:[t.first_name," ",t.last_name]}),e.jsxs("div",{className:"text-sm theme-text-muted",children:[t.age," yosh"]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm theme-text",children:t.disease_type}),t.comments&&e.jsx("div",{className:"text-xs theme-text-muted line-clamp-2 max-w-48",children:t.comments})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{size:14,className:"theme-text-muted"}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-sm theme-accent hover:text-primary-700 transition-colors duration-200",children:t.phone})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{size:16,className:t.status==="pending"?"text-yellow-600":t.status==="contacted"?"text-blue-600":t.status==="completed"?"text-green-600":"text-red-600"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${f(t.status)}`,children:S(t.status)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm theme-text-muted",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(J,{size:14}),e.jsx("span",{children:C(t.created_at)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("select",{value:t.status,onChange:l=>v(t.id,l.target.value),disabled:m===t.id,className:"text-xs px-2 py-1 theme-border border rounded theme-bg theme-text disabled:opacity-50",children:[e.jsx("option",{value:"pending",children:"Kutilmoqda"}),e.jsx("option",{value:"contacted",children:"Bog'lanildi"}),e.jsx("option",{value:"completed",children:"Yakunlandi"}),e.jsx("option",{value:"cancelled",children:"Bekor qilindi"})]}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-green-600 hover:text-green-900 p-1 rounded",title:"Qo'ng'iroq qilish",children:e.jsx(_,{size:16})}),e.jsx("button",{onClick:()=>j(t.id,`${t.first_name} ${t.last_name}`),disabled:p===t.id,className:"text-red-600 hover:text-red-900 p-1 rounded disabled:opacity-50",title:"O'chirish",children:p===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(P,{size:16})})]})})]},t.id)})})]})})}),w.length===0&&!h&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(A,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold theme-text-secondary mb-2",children:"Maslahat so'rovi topilmadi"}),e.jsx("p",{className:"theme-text-muted",children:"Qidiruv so'zini o'zgartiring yoki filtrlarni qayta sozlang"})]})]})},le=({stats:r})=>{const i=[{name:"Jami So'rovlar",value:r.total.toLocaleString(),icon:A,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Kutilmoqda",value:r.pending.toLocaleString(),icon:L,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Bog'lanildi",value:r.contacted.toLocaleString(),icon:_,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Yakunlandi",value:r.completed.toLocaleString(),icon:z,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Bekor qilindi",value:r.cancelled.toLocaleString(),icon:$,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"},{name:"Oxirgi 7 kun",value:r.recent.toLocaleString(),icon:Z,color:"from-primary-500 to-primary-600",bgColor:"bg-primary-100 dark:bg-primary-900/20",textColor:"text-primary-600 dark:text-primary-400"}];return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:i.map(s=>{const c=s.icon;return e.jsxs("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-4 hover:theme-shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${s.bgColor}`,children:e.jsx(c,{size:20,className:s.textColor})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold theme-text mb-1",children:s.value}),e.jsx("p",{className:"text-xs theme-text-secondary",children:s.name})]})]},s.name)})})},we=()=>{K();const[r,i]=o.useState([]),[s,c]=o.useState([]),[h,g]=o.useState(!0),[m,y]=o.useState(""),[p,n]=o.useState("all"),[u,d]=o.useState("all"),[x,v]=o.useState(""),[j,w]=o.useState("all");o.useEffect(()=>{f()},[]);const f=async()=>{g(!0);try{const[a,l]=await Promise.all([E(),O()]);a.data&&i(a.data),l.data&&c(l.data)}catch(a){console.error("Error loading data:",a)}finally{g(!1)}},k={total:r.length,confirmed:r.filter(a=>a.email_confirmed_at).length,unconfirmed:r.filter(a=>!a.email_confirmed_at).length,emailUsers:r.filter(a=>a.app_metadata?.provider==="email").length,googleUsers:r.filter(a=>a.app_metadata?.provider==="google").length,recentSignups:r.filter(a=>{const l=new Date;return l.setDate(l.getDate()-7),new Date(a.created_at)>l}).length},S={total:s.length,pending:s.filter(a=>a.status==="pending").length,contacted:s.filter(a=>a.status==="contacted").length,completed:s.filter(a=>a.status==="completed").length,cancelled:s.filter(a=>a.status==="cancelled").length,recent:s.filter(a=>{const l=new Date;return l.setDate(l.getDate()-7),new Date(a.created_at)>l}).length},C={total:r.length,byRole:r.reduce((a,l)=>{const b=l.user_metadata?.role||"patient";return a[b]=(a[b]||0)+1,a},{}),byProvider:r.reduce((a,l)=>{const b=l.app_metadata?.provider||"email";return a[b]=(a[b]||0)+1,a},{})},t={total:s.length,pending:s.filter(a=>a.status==="pending").length,contacted:s.filter(a=>a.status==="contacted").length,completed:s.filter(a=>a.status==="completed").length,cancelled:s.filter(a=>a.status==="cancelled").length};return h?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"theme-text-muted",children:"Foydalanuvchilar yuklanmoqda..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:"Foydalanuvchilar Boshqaruvi"}),e.jsx("p",{className:"theme-text-secondary",children:"Supabase Auth foydalanuvchilarini boshqarish"})]})}),e.jsx(re,{stats:k}),e.jsx(te,{searchTerm:m,selectedRole:p,selectedProvider:u,onSearchChange:y,onRoleChange:n,onProviderChange:d,userCounts:C}),e.jsx(ae,{searchTerm:m,selectedRole:p,selectedProvider:u}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold theme-text flex items-center space-x-2",children:[e.jsx(A,{size:20,className:"text-primary-600"}),e.jsx("span",{children:"Bepul Maslahat So'rovlari"})]}),e.jsx("p",{className:"theme-text-secondary text-sm",children:"Saytdan kelgan maslahat so'rovlari"})]})}),e.jsx(le,{stats:S}),e.jsx("div",{className:"theme-bg rounded-lg theme-shadow theme-border border p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:"Maslahat so'rovlarini qidiring...",value:x,onChange:a=>v(a.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 theme-text"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsxs("select",{value:j,onChange:a=>w(a.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 appearance-none theme-text",children:[e.jsxs("option",{value:"all",children:["Barcha holatlar (",t.total,")"]}),e.jsxs("option",{value:"pending",children:["Kutilmoqda (",t.pending,")"]}),e.jsxs("option",{value:"contacted",children:["Bog'lanildi (",t.contacted,")"]}),e.jsxs("option",{value:"completed",children:["Yakunlandi (",t.completed,")"]}),e.jsxs("option",{value:"cancelled",children:["Bekor qilindi (",t.cancelled,")"]})]})]})})]})}),e.jsx(se,{searchTerm:x,selectedStatus:j})]})]})};export{we as default};
